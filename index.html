<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Economics Quiz - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="manifest" href="/site.webmanifest">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --neon-blue: #00FFFF;
            --silver-mirror: #C0C0C0;
            --charcoal-gray: #1C1C1C;
            --lime-green: #32CD32;
            --neon-red: #FF3131;
            --white: #FFFFFF;
            --sidebar-width: 260px;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--charcoal-gray);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
            display: flex;
        }
        
        body.light-mode {
            background-color: #f0f0f0;
            color: #333;
        }

        /* --- Sidebar Styling --- */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: rgba(20, 20, 20, 0.98);
            border-right: 1px solid var(--neon-blue);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease-in-out;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2.0rem;
            color: var(--neon-blue);
            filter: drop-shadow(0 0 8px var(--neon-blue));
            margin-bottom: 5px;
        }

        .logo h1 {
            font-size: 24px;
            background: linear-gradient(to right, var(--neon-blue), var(--silver-mirror));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
            line-height: 1;
        }

        .nav-links {
            display: flex;
            flex-direction: column;
            padding: 20px 10px;
            gap: 10px;
            flex-grow: 1;
        }

        .nav-link {
            color: var(--silver-mirror);
            text-decoration: none;
            font-weight: 500;
            padding: 12px 20px;
            border-radius: 10px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }

        body.light-mode .nav-link {
            color: #555;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(0, 255, 255, 0.1);
            color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
            border-left: 3px solid var(--neon-blue);
        }

        .nav-link i {
            width: 25px;
            text-align: center;
            font-size: 18px;
        }

        .sidebar-footer {
            padding: 20px;
            text-align: center;
            font-size: 12px;
            color: #666;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* --- Main Content Area --- */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 0;
            min-height: 100vh;
            width: calc(100% - var(--sidebar-width));
            transition: margin-left 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 36px 30px;
            min-height: calc(100vh - 80px); /* Adjust for footer */
        }

        /* --- Mobile Toggle Button --- */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(20, 20, 20, 0.9);
            color: var(--neon-blue);
            border: 2px solid var(--neon-blue);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            font-size: 1.2rem;
        }
        
        body.light-mode .mobile-toggle {
            background: white;
            color: #0099cc;
            border-color: #0099cc;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            backdrop-filter: blur(3px);
        }

        /* --- Page Styling (Preserved) --- */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page.active {
            display: block;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 36px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
        }
        
        .page-title {
            font-size: 36px;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--neon-blue), var(--silver-mirror));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        .page-subtitle {
            font-size: 24px;
            color: var(--silver-mirror);
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Home Page */
        .welcome-section {
            text-align: center;
            padding: 36px 20px;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 20px;
            margin-bottom: 36px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        body.light-mode .welcome-section {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .welcome-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--neon-blue);
        }
        
        .welcome-section p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 36px 0;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.2);
            transition: transform 0.3s;
        }
        
        body.light-mode .stat-card {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .stat-card:hover {
            transform: translateY(-10px);
            border-color: var(--neon-blue);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.2);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            color: var(--neon-blue);
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 2.2rem;
            font-weight: 600;
            color: var(--neon-blue);
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: var(--silver-mirror);
        }
        
        body.light-mode .stat-label {
            color: #666;
        }
        
        .btn {
            justify-content: center;
            background: linear-gradient(135deg, var(--neon-blue) 0%, #0099cc 100%);
            color: var(--charcoal-gray);
            border: none;
            padding: 15px 25px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
            display: flex;
            flex-direction: row;
            align-items: center;
            margin: 10px;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.5);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--silver-mirror) 0%, #888 100%);
            color: var(--charcoal-gray);
        }
        
        .btn i {
            font-size: 18px;
            margin-right: 5px;
            margin-left: 5px;
            }
        
        /* Modules Page */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 36px;
        }
        
        .module-card {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 2px solid rgba(0, 255, 255, 0.2);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        body.light-mode .module-card {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .module-card:hover {
            transform: translateY(-10px);
            border-color: var(--neon-blue);
            box-shadow: 0 15px 30px rgba(0, 255, 255, 0.2);
        }
        
        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--neon-blue), var(--silver-mirror));
        }
        
        .module-icon {
            font-size: 36px;
            color: var(--neon-blue);
            margin: 20px;
        }
        
        .module-title {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--neon-blue);
        }
        
        .module-description {
            color: var(--silver-mirror);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        body.light-mode .module-description {
            color: #666;
        }
        
        .module-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .module-stat {
            text-align: center;
        }
        
        .module-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--neon-blue);
        }
        
        .module-stat-label {
            font-size: 12px;
            color: var(--silver-mirror);
        }
        
        /* Settings Page */
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 10px;
            padding: 36px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        body.light-mode .settings-container {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .setting-group {
            margin-bottom: 36px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .setting-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--neon-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .setting-option {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            min-width: 250px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        body.light-mode .setting-option {
            background: rgba(240, 240, 240, 0.9);
        }
        
        .setting-option:hover {
            border-color: var(--neon-blue);
        }
        
        .option-title {
            font-size: 24px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--neon-blue);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .slider-container {
            margin-top: 15px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slider {
            width: 100%;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            border-radius: 5px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--neon-blue);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        /* Analytics Page */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 36px;
        }
        
        .analytics-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        body.light-mode .analytics-card {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .analytics-card.wide {
            grid-column: 1 / -1;
        }
        
        .analytics-title {
            font-size: 36px;
            margin-bottom: 20px;
            color: var(--neon-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .analytics-table th, .analytics-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.light-mode .analytics-table th, 
        body.light-mode .analytics-table td {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .analytics-table th {
            color: var(--neon-blue);
            font-weight: 600;
        }
        
        .progress-cell {
            width: 200px;
        }
        
        .progress-bar-bg {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(to right, var(--neon-blue), var(--lime-green));
            border-radius: 5px;
        }
        
        /* Review Page */
        .review-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        body.light-mode .review-container {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .review-filter {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        body.light-mode .filter-btn {
            background: rgba(240, 240, 240, 0.9);
            color: #333;
        }
        
        .filter-btn.active, .filter-btn:hover {
            border-color: var(--neon-blue);
            background: rgba(0, 255, 255, 0.1);
        }
        
        .review-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .review-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid var(--neon-red);
            transition: all 0.3s;
        }
        
        body.light-mode .review-item {
            background: rgba(240, 240, 240, 0.9);
        }
        
        .review-item.correct {
            border-left-color: var(--lime-green);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .question-topic {
            background: rgba(0, 255, 255, 0.1);
            color: var(--neon-blue);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 24px;
        }
        
        .question-text {
            font-size: 18px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .answer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .answer-comparison {
                grid-template-columns: 1fr;
            }
        }
        
        .answer-box {
            padding: 20px;
            border-radius: 10px;
        }
        
        .user-answer-box {
            background: rgba(255, 49, 49, 0.1);
            border: 2px solid var(--neon-red);
        }
        
        .correct-answer-box {
            background: rgba(50, 205, 50, 0.1);
            border: 2px solid var(--lime-green);
        }
        
        .answer-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-answer-label {
            color: var(--neon-red);
        }
        
        .correct-answer-label {
            color: var(--lime-green);
        }
        
        .explanation-box {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 5px solid var(--neon-blue);
        }
        
        body.light-mode .explanation-box {
            background: rgba(220, 220, 220, 0.9);
        }
        
        .explanation-title {
            color: var(--neon-blue);
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Download Report Page */
        .download-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 36px;
        }
        
        .download-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 2px solid rgba(0, 255, 255, 0.2);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        body.light-mode .download-card {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .download-card:hover {
            transform: translateY(-10px);
            border-color: var(--neon-blue);
            box-shadow: 0 15px 30px rgba(0, 255, 255, 0.2);
        }
        
        .download-icon {
            font-size: 36px;
            color: var(--neon-blue);
            margin-bottom: 20px;
        }
        
        .download-title {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--neon-blue);
        }
        
        .download-description {
            color: var(--silver-mirror);
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        body.light-mode .download-description {
            color: #666;
        }
        
        /* Feedback Page */
        .feedback-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 20px;
            padding: 36px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        body.light-mode .feedback-container {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--neon-blue);
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        body.light-mode .form-input,
        body.light-mode .form-textarea,
        body.light-mode .form-select {
            background: rgba(240, 240, 240, 0.9);
            color: #333;
            border: 2px solid rgba(0, 0, 0, 0.1);
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .rating-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .rating-star {
            font-size: 2rem;
            color: var(--silver-mirror);
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .rating-star.active, .rating-star:hover {
            color: gold;
        }
        
        /* Quiz Page */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
        }
        
        .quiz-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .timer-container {
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            border-radius: 50px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            font-weight: 600;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .timer-container i {
            color: var(--neon-blue);
        }
        
        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .progress-text {
            font-weight: 600;
        }
        
        .progress-bar {
            width: 200px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--neon-blue), var(--lime-green));
            width: 0%;
            transition: width 0.5s;
            border-radius: 5px;
        }
        
        .question-container {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 20px;
            padding: 36px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .question-number {
            color: var(--neon-blue);
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.5;
            margin-bottom: 30px;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .options-container {
                grid-template-columns: 1fr;
            }
        }
        
        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.5);
        }
        
        .option.selected {
            background: rgba(0, 255, 255, 0.2);
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .option.correct {
            background: rgba(50, 205, 50, 0.2);
            border-color: var(--lime-green);
        }
        
        .option.incorrect {
            background: rgba(255, 49, 49, 0.2);
            border-color: var(--neon-red);
        }
        
        .option-letter {
            width: 36px;
            height: 36px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--neon-blue);
        }
        
        .option-text {
            flex: 1;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 30px 20px;
            background: rgba(20, 20, 20, 0.95);
            border-top: 2px solid rgba(0, 255, 255, 0.3);
            margin-top: auto;
        }
        
        body.light-mode footer {
            background: rgba(240, 240, 240, 0.95);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .copyright {
            color: var(--silver-mirror);
            font-size: 12px;
        }

        /* --- Responsive & Mobile Styles --- */
        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }
            
            .overlay.active {
                display: block;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding-top: 60px; /* Space for mobile toggle */
            }
            
            .container {
                padding: 20px 15px;
            }

            .page-title {
                font-size: 36px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modules-grid {
                grid-template-columns: 1fr;
            }
            
            .quiz-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .quiz-progress {
                flex-direction: column;
                gap: 5px;
            }

            .nav-link {
                padding: 15px 20px; /* Larger touch target */
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" id="mobile-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>Micro Economics<br>Quiz</h1>
            </div>
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link active" data-page="home">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="#" class="nav-link" data-page="modules">
                <i class="fas fa-book-open"></i> Modules
            </a>
            <a href="#" class="nav-link" data-page="quiz">
                <i class="fas fa-question-circle"></i> Full Quiz
            </a>
            <a href="#" class="nav-link" data-page="analytics">
                <i class="fas fa-chart-line"></i> Analytics
            </a>
            <a href="#" class="nav-link" data-page="review">
                <i class="fas fa-clipboard-check"></i> Review
            </a>
            <a href="#" class="nav-link" data-page="download">
                <i class="fas fa-download"></i> Download Report
            </a>
            <a href="#" class="nav-link" data-page="feedback">
                <i class="fas fa-comment-dots"></i> Feedback
            </a>
            <a href="#" class="nav-link" data-page="settings">
                <i class="fas fa-cog"></i> Settings
            </a>
        </div>
        <div class="sidebar-footer">
            <p>© 2023 yD<br>v1.0.0</p>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="container">
            <!-- Home Page -->
            <div class="page active" id="home-page">
                <div class="page-header">
                    <h1 class="page-title">Welcome to Micro Economics Quiz Platform</h1>
                    <p class="page-subtitle">Master Micro Economics concepts through interactive quizzes, detailed analytics, and personalized learning modules.</p>
                </div>
                
                <div class="welcome-section">
                    <h2>Test Your Knowledge</h2>
                    <p>This platform is designed to help yclone-designs students master Micro Economics concepts through engaging quizzes, detailed explanations, and progress tracking.</p>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-question-circle stat-icon"></i>
                            <div class="stat-number" id="total-questions">60</div>
                            <div class="stat-label">Total Questions</div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-book stat-icon"></i>
                            <div class="stat-number" id="total-modules">6</div>
                            <div class="stat-label">Learning Modules</div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-chart-line stat-icon"></i>
                            <div class="stat-number" id="avg-score">0%</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-clock stat-icon"></i>
                            <div class="stat-number" id="total-time">0</div>
                            <div class="stat-label">Minutes Studied</div>
                        </div>
                    </div>
                    <a href="#" class="btn start-quiz-btn" data-page="quiz">
                        <i class="fas fa-play"></i> Start Full Quiz
                    </a>
                    <a href="#" class="btn btn-secondary" data-page="modules">
                        <i class="fas fa-book-open"></i> Browse Modules
                    </a>
                </div>
                
                <div style="text-align: center; margin-top: 36px;">
                    <h2 style="color: var(--neon-blue); margin-bottom: 20px;">Quick Links</h2>
                    <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        <a href="#" class="btn" data-page="analytics" style="padding: 10px 25px;">
                            <i class="fas fa-chart-pie"></i> View Analytics
                        </a>
                        <a href="#" class="btn" data-page="review" style="padding: 10px 25px;">
                            <i class="fas fa-redo"></i> Review Mistakes
                        </a>
                        <a href="#" class="btn" data-page="download" style="padding: 10px 25px;">
                            <i class="fas fa-file-download"></i> Download Report
                        </a>
                    </div>
                </div>
            </div>

            <!-- Modules Page -->
            <div class="page" id="modules-page">
                <div class="page-header">
                    <h1 class="page-title">Learning Modules</h1>
                    <p class="page-subtitle">Select a topic module to focus your learning. Each module contains questions specific to that topic.</p>
                </div>
                
                <div class="modules-grid" id="modules-grid">
                    <!-- Modules will be loaded by JavaScript -->
                </div>
            </div>

            <!-- Quiz Page -->
            <div class="page" id="quiz-page">
                <div class="quiz-header">
                    <div>
                        <h2 style="color: var(--neon-blue);" id="quiz-title">Full Micro Economics Quiz</h2>
                        <p id="quiz-description">60 questions • 60 minutes</p>
                    </div>
                    <div class="quiz-info">
                        <div class="timer-container">
                            <i class="fas fa-clock"></i>
                            <span id="timer">60:00</span>
                        </div>
                        <div class="quiz-progress">
                            <div class="progress-text">Question <span id="current-q">1</span> of <span id="total-q">60</span></div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="question-container">
                    <div class="question-number" id="question-number">Question 1</div>
                    <div class="question-text" id="question-text"></div>
                    
                    <div class="options-container" id="options-container">
                        <!-- Options will be loaded by JavaScript -->
                    </div>
                    
                    <div class="quiz-controls">
                        <button class="btn btn-secondary" id="prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn" id="next-btn">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Results Screen (hidden initially) -->
                <div id="results-screen" style="display: none;">
                    <div style="text-align: center; padding: 36px; background: rgba(30, 30, 30, 0.7); border-radius: 20px; border: 2px solid var(--neon-blue);">
                        <h1 style="color: var(--neon-blue); font-size: 36px; margin-bottom: 20px;">Quiz Completed!</h1>
                        <div style="font-size: 45px; color: var(--neon-blue); font-weight: 600; margin: 20px 0;" id="final-score">0/60</div>
                        <p style="font-size: 18px; margin-bottom: 30px;">You've completed the quiz. Check your analytics for detailed performance review.</p>
                        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                            <button class="btn" id="view-analytics-btn" data-page="analytics">
                                <i class="fas fa-chart-bar"></i> View Analytics
                            </button>
                            <button class="btn btn-secondary" id="review-mistakes-btn" data-page="review">
                                <i class="fas fa-clipboard-check"></i> Review Mistakes
                            </button>
                            <button class="btn" id="retry-quiz-btn">
                                <i class="fas fa-redo"></i> Try Again
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div class="page" id="analytics-page">
                <div class="page-header">
                    <h1 class="page-title">Performance Analytics</h1>
                    <p class="page-subtitle">Track your progress, identify strengths and weaknesses, and monitor your improvement over time.</p>
                </div>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="analytics-title"><i class="fas fa-chart-pie"></i> Overall Performance</h3>
                        <div class="chart-container">
                            <canvas id="overall-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3 class="analytics-title"><i class="fas fa-trend-up"></i> Progress Over Time</h3>
                        <div class="chart-container">
                            <canvas id="progress-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card wide">
                        <h3 class="analytics-title"><i class="fas fa-list-ol"></i> Module Performance</h3>
                        <table class="analytics-table">
                            <thead>
                                <tr>
                                    <th>Module</th>
                                    <th>Questions</th>
                                    <th>Correct</th>
                                    <th>Accuracy</th>
                                    <th class="progress-cell">Progress</th>
                                </tr>
                            </thead>
                            <tbody id="module-performance">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="analytics-card">
                        <h3 class="analytics-title"><i class="fas fa-clock"></i> Time Management</h3>
                        <div class="chart-container">
                            <canvas id="time-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3 class="analytics-title"><i class="fas fa-trophy"></i> Achievements</h3>
                        <div id="achievements-list" style="display: flex; flex-direction: column; gap: 15px;">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Page -->
            <div class="page" id="review-page">
                <div class="page-header">
                    <h1 class="page-title">Review & Learn</h1>
                    <p class="page-subtitle">Review questions you answered incorrectly with detailed explanations to improve your understanding.</p>
                </div>
                
                <div class="review-container">
                    <div class="review-filter">
                        <button class="filter-btn active" data-filter="all">All Questions</button>
                        <button class="filter-btn" data-filter="incorrect">Incorrect Only</button>
                        <button class="filter-btn" data-filter="module">By Module</button>
                        <select class="filter-btn" id="module-filter" style="display: none;">
                            <option value="all">All Modules</option>
                            <!-- Module options will be populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div class="review-list" id="review-list">
                        <!-- Review items will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Download Report Page -->
            <div class="page" id="download-page">
                <div class="page-header">
                    <h1 class="page-title">Download Reports</h1>
                    <p class="page-subtitle">Download detailed reports of your performance for offline review or sharing with instructors.</p>
                </div>
                
                <div class="download-options">
                    <div class="download-card" id="download-pdf">
                        <i class="fas fa-file-pdf download-icon"></i>
                        <h3 class="download-title">PDF Report</h3>
                        <p class="download-description">Download a comprehensive PDF report with all your quiz results, analytics, and performance metrics.</p>
                        <button class="btn">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                    </div>
                    
                    <div class="download-card" id="download-csv">
                        <i class="fas fa-file-csv download-icon"></i>
                        <h3 class="download-title">CSV Data</h3>
                        <p class="download-description">Export your quiz data in CSV format for further analysis in spreadsheet applications.</p>
                        <button class="btn">
                            <i class="fas fa-download"></i> Download CSV
                        </button>
                    </div>
                    
                    <div class="download-card" id="download-certificate">
                        <i class="fas fa-certificate download-icon"></i>
                        <h3 class="download-title">Certificate</h3>
                        <p class="download-description">Generate a personalized certificate of completion for your Micro Economics quiz achievement.</p>
                        <button class="btn">
                            <i class="fas fa-download"></i> Generate Certificate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Feedback Page -->
            <div class="page" id="feedback-page">
                <div class="page-header">
                    <h1 class="page-title">Feedback & Suggestions</h1>
                    <p class="page-subtitle">Help us improve the platform by sharing your feedback, suggestions, or reporting issues.</p>
                </div>
                
                <div class="feedback-container">
                    <form id="feedback-form">
                        <div class="form-group">
                            <label class="form-label">Name (Optional)</label>
                            <input type="text" class="form-input" id="feedback-name" placeholder="Your name">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email (Optional)</label>
                            <input type="email" class="form-input" id="feedback-email" placeholder="Your email">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Feedback Type</label>
                            <select class="form-select" id="feedback-type">
                                <option value="suggestion">Suggestion</option>
                                <option value="bug">Bug Report</option>
                                <option value="question">Question</option>
                                <option value="compliment">Compliment</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Overall Rating</label>
                            <div class="rating-container">
                                <span class="rating-star" data-value="1">★</span>
                                <span class="rating-star" data-value="2">★</span>
                                <span class="rating-star" data-value="3">★</span>
                                <span class="rating-star" data-value="4">★</span>
                                <span class="rating-star" data-value="5">★</span>
                            </div>
                            <input type="hidden" id="rating-value" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Your Feedback</label>
                            <textarea class="form-textarea" id="feedback-message" placeholder="Please provide detailed feedback..." required></textarea>
                        </div>
                        
                        <div style="text-align: center;">
                            <button type="submit" class="btn" style="width: 100%;">
                                <i class="fas fa-paper-plane"></i> Submit Feedback
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="settings-page">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Customize your learning experience with themes, audio settings, and preferences.</p>
                </div>
                
                <div class="settings-container">
                    <div class="setting-group">
                        <h3 class="setting-title"><i class="fas fa-palette"></i> Theme Settings</h3>
                        <div class="setting-options">
                            <div class="setting-option">
                                <div class="option-title">
                                    Dark Mode
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="dark-mode-toggle" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <p style="color: var(--silver-mirror); margin-top: 10px; font-size: 12px;">Switch between dark and light themes for better visibility.</p>
                            </div>
                            
                            <div class="setting-option">
                                <div class="option-title">
                                    Neon Intensity
                                </div>
                                <div class="slider-container">
                                    <div class="slider-label">
                                        <span>Subtle</span>
                                        <span id="neon-intensity-value">Medium</span>
                                        <span>Bright</span>
                                    </div>
                                    <input type="range" min="1" max="3" value="2" class="slider" id="neon-intensity">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3 class="setting-title"><i class="fas fa-volume-up"></i> Audio Settings</h3>
                        <div class="setting-options">
                            <div class="setting-option">
                                <div class="option-title">
                                    Sound Effects
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="sound-effects-toggle" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <p style="color: var(--silver-mirror); margin-top: 10px; font-size: 12px;">Enable or disable sound effects during quizzes.</p>
                            </div>
                            
                            <div class="setting-option">
                                <div class="option-title">
                                    Volume Level
                                </div>
                                <div class="slider-container">
                                    <div class="slider-label">
                                        <span>Low</span>
                                        <span id="volume-level-value">Medium</span>
                                        <span>High</span>
                                    </div>
                                    <input type="range" min="1" max="10" value="5" class="slider" id="volume-level">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3 class="setting-title"><i class="fas fa-user-cog"></i> Quiz Preferences</h3>
                        <div class="setting-options">
                            <div class="setting-option">
                                <div class="option-title">
                                    Show Explanations Immediately
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="explanations-toggle" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <p style="color: var(--silver-mirror); margin-top: 10px; font-size: 12px;">Show answer explanations immediately after answering a question.</p>
                            </div>
                            
                            <div class="setting-option">
                                <div class="option-title">
                                    Timer Visibility
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="timer-toggle" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <p style="color: var(--silver-mirror); margin-top: 10px; font-size: 12px;">Show or hide the countdown timer during quizzes.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3 class="setting-title"><i class="fas fa-database"></i> Data Management</h3>
                        <div class="setting-options">
                            <div class="setting-option">
                                <div class="option-title">
                                    Reset All Data
                                </div>
                                <p style="color: var(--silver-mirror); margin-top: 10px; font-size: 12px;">Clear all quiz history, progress, and settings.</p>
                                <button class="btn btn-secondary" id="reset-data-btn" style="margin-top: 15px; width: 100%;">
                                    <i class="fas fa-trash-alt"></i> Reset All Data
                                </button>
                            </div>
                            
                            <div class="setting-option">
                                <div class="option-title">
                                    Export Data
                                </div>
                                <p style="color: var(--silver-mirror); margin-top: 10px; font-size: 12px;">Export your quiz data for backup or transfer.</p>
                                <button class="btn" id="export-data-btn" style="margin-top: 15px; width: 100%;">
                                    <i class="fas fa-file-export"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer (Moved inside main content area) -->
            <footer>
                <div class="footer-content">
                    <p class="copyright">
                        yclone-designs - Micro Economics Quiz Platform © 2023<br>
                        All rights reserved | Developed for Educational Purposes
                    </p>
                </div>
            </footer>
        </div>
    </main>

    <!-- Audio Elements -->
    <audio id="correct-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>
    <audio id="incorrect-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    <audio id="click-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="complete-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>

    <!-- JavaScript -->
    <script>
        // --- Sidebar & Mobile Menu Logic ---
        const mobileToggle = document.getElementById('mobile-toggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const sidebarLinks = document.querySelectorAll('.nav-link');

        function toggleSidebar() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }

        mobileToggle.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', closeSidebar);
        
        // Close sidebar when a link is clicked on mobile
        sidebarLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    closeSidebar();
                }
            });
        });

        // --- Original Quiz App Logic (Preserved) ---
        
        // Quiz Data - Organized by Modules
        const quizData = {
            modules: [
                {
                    id: 1,
                    name: "Introduction to Economics",
                    icon: "fas fa-globe",
                    description: "Basic economic concepts, scarcity, opportunity cost, and production possibilities.",
                    questions: [
                        {
                            id: 1,
                            question: "What is the fundamental problem in economics?",
                            options: ["Unemployment", "Scarcity", "Inflation", "Market failure"],
                            correctAnswer: 1,
                            explanation: "Scarcity is the fundamental problem because resources are limited while wants are unlimited."
                        },
                        {
                            id: 2,
                            question: "What does opportunity cost represent?",
                            options: ["The monetary cost of a good", "The value of the next best alternative", "The total cost of production", "The implicit cost only"],
                            correctAnswer: 1,
                            explanation: "Opportunity cost is the value of the next best alternative forgone when making a choice."
                        },
                        {
                            id: 3,
                            question: "The production possibilities frontier illustrates:",
                            options: ["Market equilibrium", "Consumer preferences", "Trade-offs and opportunity costs", "Price elasticity"],
                            correctAnswer: 2,
                            explanation: "The PPF shows the maximum combinations of goods that can be produced, illustrating trade-offs."
                        }
                    ]
                },
                {
                    id: 2,
                    name: "Demand and Supply",
                    icon: "fas fa-balance-scale",
                    description: "Market forces, equilibrium, elasticity, and government interventions.",
                    questions: [
                        {
                            id: 4,
                            question: "According to the law of demand:",
                            options: ["Price and quantity demanded are directly related", "Price and quantity demanded are inversely related", "Demand is unaffected by price", "Demand always increases with income"],
                            correctAnswer: 1,
                            explanation: "The law of demand states that as price increases, quantity demanded decreases (inverse relationship)."
                        },
                        {
                            id: 5,
                            question: "A price ceiling set below equilibrium price results in:",
                            options: ["Surplus", "Shortage", "Equilibrium", "No effect"],
                            correctAnswer: 1,
                            explanation: "A price ceiling below equilibrium creates a shortage because quantity demanded exceeds quantity supplied."
                        },
                        {
                            id: 6,
                            question: "Elastic demand means:",
                            options: ["Quantity demanded changes little with price", "Quantity demanded changes significantly with price", "Demand is perfectly vertical", "Demand is unaffected by price"],
                            correctAnswer: 1,
                            explanation: "Elastic demand means quantity demanded is very responsive to price changes."
                        }
                    ]
                },
                {
                    id: 3,
                    name: "Consumer Behavior",
                    icon: "fas fa-shopping-cart",
                    description: "Utility theory, indifference curves, budget constraints, and consumer choice.",
                    questions: [
                        {
                            id: 7,
                            question: "The law of diminishing marginal utility states that:",
                            options: ["Total utility decreases with consumption", "Marginal utility decreases with additional units", "Utility can be measured precisely", "Utility is always positive"],
                            correctAnswer: 1,
                            explanation: "As consumption increases, the additional utility from each extra unit decreases."
                        },
                        {
                            id: 8,
                            question: "An indifference curve shows:",
                            options: ["All affordable combinations", "All combinations yielding equal utility", "The budget constraint", "Market equilibrium"],
                            correctAnswer: 1,
                            explanation: "Indifference curves represent combinations of goods that provide equal satisfaction."
                        },
                        {
                            id: 9,
                            question: "The marginal rate of substitution measures:",
                            options: ["Price ratio", "Willingness to trade one good for another", "Income elasticity", "Budget line slope"],
                            correctAnswer: 1,
                            explanation: "MRS is the rate at which a consumer is willing to substitute one good for another."
                        }
                    ]
                },
                {
                    id: 4,
                    name: "Production and Costs",
                    icon: "fas fa-industry",
                    description: "Production functions, costs, returns to scale, and efficiency.",
                    questions: [
                        {
                            id: 10,
                            question: "In the short run, at least one input is:",
                            options: ["Variable", "Fixed", "Increasing", "Decreasing"],
                            correctAnswer: 1,
                            explanation: "The short run is defined as a period where at least one input is fixed."
                        },
                        {
                            id: 11,
                            question: "Marginal cost is:",
                            options: ["Total cost divided by quantity", "Change in total cost from one more unit", "Fixed cost per unit", "Average variable cost"],
                            correctAnswer: 1,
                            explanation: "Marginal cost is the additional cost of producing one more unit."
                        },
                        {
                            id: 12,
                            question: "Economies of scale occur when:",
                            options: ["Average cost increases with output", "Average cost decreases with output", "Marginal cost is constant", "Fixed costs are zero"],
                            correctAnswer: 1,
                            explanation: "Economies of scale mean average total cost falls as output increases."
                        }
                    ]
                },
                {
                    id: 5,
                    name: "Market Structures",
                    icon: "fas fa-chart-bar",
                    description: "Perfect competition, monopoly, monopolistic competition, and oligopoly.",
                    questions: [
                        {
                            id: 13,
                            question: "In perfect competition, firms are:",
                            options: ["Price makers", "Price takers", "Quantity setters", "Quality differentiators"],
                            correctAnswer: 1,
                            explanation: "Perfectly competitive firms accept the market price as given."
                        },
                        {
                            id: 14,
                            question: "A monopoly has:",
                            options: ["Many close substitutes", "No close substitutes", "Free entry and exit", "Perfect information"],
                            correctAnswer: 1,
                            explanation: "A monopoly is the sole seller of a product with no close substitutes."
                        },
                        {
                            id: 15,
                            question: "Monopolistic competition features:",
                            options: ["Homogeneous products", "Differentiated products", "No advertising", "Single seller"],
                            correctAnswer: 1,
                            explanation: "Firms in monopolistic competition sell differentiated products."
                        }
                    ]
                },
                {
                    id: 6,
                    name: "Elasticity",
                    icon: "fas fa-expand-alt",
                    description: "Price elasticity, income elasticity, cross elasticity, and applications.",
                    questions: [
                        {
                            id: 16,
                            question: "Price elasticity of demand measures:",
                            options: ["Quantity supplied response to price", "Quantity demanded response to price", "Income effect", "Substitution effect"],
                            correctAnswer: 1,
                            explanation: "Price elasticity of demand measures how quantity demanded responds to price changes."
                        },
                        {
                            id: 17,
                            question: "For a normal good, income elasticity is:",
                            options: ["Negative", "Positive", "Zero", "Infinite"],
                            correctAnswer: 1,
                            explanation: "Normal goods have positive income elasticity (demand increases with income)."
                        },
                        {
                            id: 18,
                            question: "Substitutes have _____ cross-price elasticity.",
                            options: ["Negative", "Positive", "Zero", "Unitary"],
                            correctAnswer: 1,
                            explanation: "Substitutes have positive cross-price elasticity (price increase of one increases demand for the other)."
                        }
                    ]
                }
            ]
        };

        // Application State
        const appState = {
            currentPage: 'home',
            currentQuiz: null,
            currentQuestionIndex: 0,
            userAnswers: [],
            quizScore: 0,
            quizTime: 60 * 60, // 60 minutes in seconds
            timerInterval: null,
            isQuizActive: false,
            userData: {
                quizHistory: [],
                moduleProgress: {},
                settings: {
                    darkMode: true,
                    soundEnabled: true,
                    volumeLevel: 5,
                    showExplanations: true,
                    showTimer: true
                },
                feedback: []
            },
            audioElements: {
                correct: document.getElementById('correct-sound'),
                incorrect: document.getElementById('incorrect-sound'),
                click: document.getElementById('click-sound'),
                complete: document.getElementById('complete-sound')
            }
        };

        // Initialize the application
        function initApp() {
            loadUserData();
            setupEventListeners();
            initHomePage();
            initModulesPage();
            initSettingsPage();
            applySettings();
            showPage('home');
        }

        function loadUserData() {
            const savedData = localStorage.getItem('microEconomicsQuizData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    appState.userData = { ...appState.userData, ...parsedData };
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
            quizData.modules.forEach(module => {
                if (!appState.userData.moduleProgress[module.id]) {
                    appState.userData.moduleProgress[module.id] = {
                        attempts: 0,
                        correct: 0,
                        total: module.questions.length,
                        bestScore: 0,
                        lastAttempt: null
                    };
                }
            });
        }

        function saveUserData() {
            try {
                localStorage.setItem('microEconomicsQuizData', JSON.stringify(appState.userData));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    showPage(page);
                });
            });

            document.querySelector('.start-quiz-btn').addEventListener('click', (e) => {
                e.preventDefault();
                startFullQuiz();
            });

            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('prev-btn').addEventListener('click', previousQuestion);
            document.getElementById('retry-quiz-btn').addEventListener('click', retryQuiz);
            document.getElementById('view-analytics-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showPage('analytics');
                initAnalyticsPage();
            });
            document.getElementById('review-mistakes-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showPage('review');
                initReviewPage();
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!this.classList.contains('active')) {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        
                        const filter = this.getAttribute('data-filter');
                        if (filter === 'module') {
                            document.getElementById('module-filter').style.display = 'block';
                        } else {
                            document.getElementById('module-filter').style.display = 'none';
                        }
                        
                        filterReviewQuestions(filter);
                    }
                });
            });

            document.getElementById('feedback-form').addEventListener('submit', submitFeedback);
            document.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    setRating(value);
                });
            });

            document.getElementById('dark-mode-toggle').addEventListener('change', toggleDarkMode);
            document.getElementById('sound-effects-toggle').addEventListener('change', toggleSoundEffects);
            document.getElementById('explanations-toggle').addEventListener('change', toggleExplanations);
            document.getElementById('timer-toggle').addEventListener('change', toggleTimer);
            document.getElementById('volume-level').addEventListener('input', updateVolume);
            document.getElementById('neon-intensity').addEventListener('input', updateNeonIntensity);
            document.getElementById('reset-data-btn').addEventListener('click', resetData);
            document.getElementById('export-data-btn').addEventListener('click', exportData);

            document.getElementById('download-pdf').addEventListener('click', downloadPDF);
            document.getElementById('download-csv').addEventListener('click', downloadCSV);
            document.getElementById('download-certificate').addEventListener('click', downloadCertificate);
        }

        function showPage(pageName) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageName) {
                    link.classList.add('active');
                }
            });

            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            const pageElement = document.getElementById(`${pageName}-page`);
            if (pageElement) {
                pageElement.classList.add('active');
                appState.currentPage = pageName;
                window.scrollTo(0, 0);

                switch(pageName) {
                    case 'home': initHomePage(); break;
                    case 'modules': initModulesPage(); break;
                    case 'analytics': initAnalyticsPage(); break;
                    case 'review': initReviewPage(); break;
                    case 'feedback': initFeedbackPage(); break;
                    case 'settings': initSettingsPage(); break;
                }
            }
        }

        function initHomePage() {
            const totalQuestions = quizData.modules.reduce((sum, module) => sum + module.questions.length, 0);
            document.getElementById('total-questions').textContent = totalQuestions;
            document.getElementById('total-modules').textContent = quizData.modules.length;
            
            let totalScore = 0;
            let totalAttempts = 0;
            
            Object.values(appState.userData.moduleProgress).forEach(progress => {
                if (progress.attempts > 0) {
                    totalScore += (progress.correct / progress.total) * 100;
                    totalAttempts++;
                }
            });
            
            const avgScore = totalAttempts > 0 ? Math.round(totalScore / totalAttempts) : 0;
            document.getElementById('avg-score').textContent = `${avgScore}%`;
            
            let totalTime = 0;
            appState.userData.quizHistory.forEach(quiz => {
                totalTime += 60; 
            });
            document.getElementById('total-time').textContent = totalTime;
        }

        function initModulesPage() {
            const modulesGrid = document.getElementById('modules-grid');
            modulesGrid.innerHTML = '';
            
            quizData.modules.forEach(module => {
                const progress = appState.userData.moduleProgress[module.id];
                const accuracy = progress.attempts > 0 ? Math.round((progress.correct / progress.total) * 100) : 0;
                
                const moduleCard = document.createElement('div');
                moduleCard.className = 'module-card';
                moduleCard.innerHTML = `
                    <i class="${module.icon} module-icon"></i>
                    <h3 class="module-title">${module.name}</h3>
                    <p class="module-description">${module.description}</p>
                    <div class="module-stats">
                        <div class="module-stat">
                            <div class="module-stat-value">${module.questions.length}</div>
                            <div class="module-stat-label">Questions</div>
                        </div>
                        <div class="module-stat">
                            <div class="module-stat-value">${progress.attempts}</div>
                            <div class="module-stat-label">Attempts</div>
                        </div>
                        <div class="module-stat">
                            <div class="module-stat-value">${accuracy}%</div>
                            <div class="module-stat-label">Accuracy</div>
                        </div>
                    </div>
                    <button class="btn" style="margin-top: 20px; width: 100%;" data-module-id="${module.id}">
                        <i class="fas fa-play"></i> Start Module Quiz
                    </button>
                `;
                
                modulesGrid.appendChild(moduleCard);
                moduleCard.querySelector('button').addEventListener('click', () => {
                    startModuleQuiz(module.id);
                });
            });
        }

        function startFullQuiz() {
            const allQuestions = [];
            quizData.modules.forEach(module => {
                module.questions.forEach(q => {
                    allQuestions.push({
                        ...q,
                        moduleId: module.id,
                        moduleName: module.name
                    });
                });
            });
            
            const shuffledQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
            
            appState.currentQuiz = {
                type: 'full',
                questions: shuffledQuestions,
                title: 'Full Micro Economics Quiz',
                description: `${allQuestions.length} questions • 60 minutes`
            };
            
            startQuiz();
        }

        function startModuleQuiz(moduleId) {
            const module = quizData.modules.find(m => m.id === moduleId);
            if (!module) return;
            
            const shuffledQuestions = [...module.questions].sort(() => Math.random() - 0.5);
            
            appState.currentQuiz = {
                type: 'module',
                moduleId: moduleId,
                questions: shuffledQuestions,
                title: module.name + ' Quiz',
                description: `${module.questions.length} questions • ${Math.ceil(module.questions.length * 1.5)} minutes`
            };
            
            startQuiz();
        }

        function startQuiz() {
            if (!appState.currentQuiz) return;
            
            appState.currentQuestionIndex = 0;
            appState.userAnswers = new Array(appState.currentQuiz.questions.length).fill(null);
            appState.quizScore = 0;
            appState.quizTime = appState.currentQuiz.type === 'full' ? 60 * 60 : Math.ceil(appState.currentQuiz.questions.length * 1.5) * 60;
            appState.isQuizActive = true;
            
            document.getElementById('quiz-title').textContent = appState.currentQuiz.title;
            document.getElementById('quiz-description').textContent = appState.currentQuiz.description;
            document.getElementById('total-q').textContent = appState.currentQuiz.questions.length;
            
            showPage('quiz');
            
            document.getElementById('results-screen').style.display = 'none';
            document.querySelector('.question-container').style.display = 'block';
            
            startTimer();
            loadQuestion();
        }

        function loadQuestion() {
            if (!appState.currentQuiz || !appState.isQuizActive) return;
            
            const question = appState.currentQuiz.questions[appState.currentQuestionIndex];
            
            document.getElementById('question-number').textContent = `Question ${appState.currentQuestionIndex + 1}`;
            document.getElementById('current-q').textContent = appState.currentQuestionIndex + 1;
            document.getElementById('question-text').textContent = question.question;
            
            const progressPercent = ((appState.currentQuestionIndex + 1) / appState.currentQuiz.questions.length) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (appState.userAnswers[appState.currentQuestionIndex] === index) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prev-btn').disabled = appState.currentQuestionIndex === 0;
            document.getElementById('next-btn').innerHTML = appState.currentQuestionIndex === appState.currentQuiz.questions.length - 1 ? 
                'Finish Quiz <i class="fas fa-flag-checkered"></i>' : 
                'Next <i class="fas fa-arrow-right"></i>';
        }

        function selectOption(optionIndex) {
            playSound('click');
            
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelectorAll('.option')[optionIndex].classList.add('selected');
            appState.userAnswers[appState.currentQuestionIndex] = optionIndex;
            
            const question = appState.currentQuiz.questions[appState.currentQuestionIndex];
            const isCorrect = optionIndex === question.correctAnswer;
            
            playSound(isCorrect ? 'correct' : 'incorrect');
            
            if (isCorrect) {
                document.querySelectorAll('.option')[optionIndex].classList.add('correct');
            } else {
                document.querySelectorAll('.option')[optionIndex].classList.add('incorrect');
                document.querySelectorAll('.option')[question.correctAnswer].classList.add('correct');
            }
            
            if (appState.userData.settings.showExplanations) {
                setTimeout(() => {
                    alert(`Explanation: ${question.explanation}`);
                }, 500);
            }
        }

        function nextQuestion() {
            playSound('click');
            if (appState.currentQuestionIndex < appState.currentQuiz.questions.length - 1) {
                appState.currentQuestionIndex++;
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        function previousQuestion() {
            playSound('click');
            if (appState.currentQuestionIndex > 0) {
                appState.currentQuestionIndex--;
                loadQuestion();
            }
        }

        function startTimer() {
            if (appState.timerInterval) clearInterval(appState.timerInterval);
            appState.timerInterval = setInterval(() => {
                if (appState.isQuizActive) {
                    appState.quizTime--;
                    const minutes = Math.floor(appState.quizTime / 60);
                    const seconds = appState.quizTime % 60;
                    document.getElementById('timer').textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                    
                    if (appState.quizTime <= 300) {
                        document.getElementById('timer').style.color = 'var(--neon-red)';
                    }
                    if (appState.quizTime <= 0) {
                        clearInterval(appState.timerInterval);
                        finishQuiz();
                    }
                }
            }, 1000);
        }

        function finishQuiz() {
            clearInterval(appState.timerInterval);
            appState.isQuizActive = false;
            playSound('complete');
            
            let correctCount = 0;
            appState.currentQuiz.questions.forEach((question, index) => {
                if (appState.userAnswers[index] === question.correctAnswer) {
                    correctCount++;
                }
            });
            
            appState.quizScore = correctCount;
            
            const quizResult = {
                id: Date.now(),
                type: appState.currentQuiz.type,
                moduleId: appState.currentQuiz.moduleId,
                date: new Date().toISOString(),
                score: correctCount,
                total: appState.currentQuiz.questions.length,
                timeSpent: (appState.currentQuiz.type === 'full' ? 60 * 60 : Math.ceil(appState.currentQuiz.questions.length * 1.5) * 60) - appState.quizTime,
                answers: [...appState.userAnswers]
            };
            
            appState.userData.quizHistory.push(quizResult);
            
            if (appState.currentQuiz.type === 'module') {
                const moduleProgress = appState.userData.moduleProgress[appState.currentQuiz.moduleId];
                moduleProgress.attempts++;
                moduleProgress.correct += correctCount;
                if (correctCount > moduleProgress.bestScore) {
                    moduleProgress.bestScore = correctCount;
                }
                moduleProgress.lastAttempt = new Date().toISOString();
            }
            
            saveUserData();
            
            document.querySelector('.question-container').style.display = 'none';
            document.getElementById('results-screen').style.display = 'block';
            document.getElementById('final-score').textContent = `${correctCount}/${appState.currentQuiz.questions.length}`;
        }

        function retryQuiz() {
            if (appState.currentQuiz) {
                startQuiz();
            }
        }

        function initAnalyticsPage() {
            const overallCtx = document.getElementById('overall-chart').getContext('2d');
            let totalCorrect = 0;
            let totalQuestions = 0;
            
            quizData.modules.forEach(module => {
                const progress = appState.userData.moduleProgress[module.id];
                totalCorrect += progress.correct;
                totalQuestions += progress.total * progress.attempts;
            });
            
            const overallAccuracy = totalQuestions > 0 ? (totalCorrect / totalQuestions) * 100 : 0;
            
            if (window.overallChartInstance) window.overallChartInstance.destroy();

            window.overallChartInstance = new Chart(overallCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect'],
                    datasets: [{
                        data: [overallAccuracy, 100 - overallAccuracy],
                        backgroundColor: ['rgba(50, 205, 50, 0.7)', 'rgba(255, 49, 49, 0.7)'],
                        borderColor: ['rgb(50, 205, 50)', 'rgb(255, 49, 49)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
            
            const progressCtx = document.getElementById('progress-chart').getContext('2d');
            const recentQuizzes = appState.userData.quizHistory.slice(-10);
            
            if (window.progressChartInstance) window.progressChartInstance.destroy();

            window.progressChartInstance = new Chart(progressCtx, {
                type: 'line',
                data: {
                    labels: recentQuizzes.map((q, i) => `Quiz ${i + 1}`),
                    datasets: [{
                        label: 'Score (%)',
                        data: recentQuizzes.map(q => (q.score / q.total) * 100),
                        borderColor: 'rgb(0, 255, 255)',
                        backgroundColor: 'rgba(0, 255, 255, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
            
            const modulePerformance = document.getElementById('module-performance');
            modulePerformance.innerHTML = '';
            
            quizData.modules.forEach(module => {
                const progress = appState.userData.moduleProgress[module.id];
                const accuracy = progress.attempts > 0 ? (progress.correct / (progress.total * progress.attempts)) * 100 : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${module.name}</td>
                    <td>${progress.total}</td>
                    <td>${progress.correct}</td>
                    <td>${accuracy.toFixed(1)}%</td>
                    <td class="progress-cell">
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" style="width: ${accuracy}%"></div>
                        </div>
                    </td>
                `;
                modulePerformance.appendChild(row);
            });
            
            const timeCtx = document.getElementById('time-chart').getContext('2d');
            
            if (window.timeChartInstance) window.timeChartInstance.destroy();

            window.timeChartInstance = new Chart(timeCtx, {
                type: 'bar',
                data: {
                    labels: quizData.modules.map(m => m.name.substring(0, 15) + '...'),
                    datasets: [{
                        label: 'Average Time (min)',
                        data: quizData.modules.map(m => {
                            const progress = appState.userData.moduleProgress[m.id];
                            return progress.attempts > 0 ? Math.ceil(m.questions.length * 1.5) : 0;
                        }),
                        backgroundColor: 'rgba(0, 255, 255, 0.7)',
                        borderColor: 'rgb(0, 255, 255)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            const achievementsList = document.getElementById('achievements-list');
            achievementsList.innerHTML = '';
            
            const achievements = [
                { name: 'First Quiz', condition: appState.userData.quizHistory.length >= 1, icon: 'fas fa-star' },
                { name: 'Module Master', condition: Object.values(appState.userData.moduleProgress).some(p => p.attempts >= 3), icon: 'fas fa-trophy' },
                { name: 'Perfect Score', condition: appState.userData.quizHistory.some(q => q.score === q.total), icon: 'fas fa-crown' },
                { name: 'Consistent Learner', condition: appState.userData.quizHistory.length >= 5, icon: 'fas fa-calendar-check' }
            ];
            
            achievements.forEach(achievement => {
                if (achievement.condition) {
                    const achievementEl = document.createElement('div');
                    achievementEl.style.display = 'flex';
                    achievementEl.style.alignItems = 'center';
                    achievementEl.style.gap = '10px';
                    achievementEl.style.padding = '10px';
                    achievementEl.style.background = 'rgba(0, 255, 255, 0.1)';
                    achievementEl.style.borderRadius = '10px';
                    achievementEl.innerHTML = `
                        <i class="${achievement.icon}" style="color: var(--neon-blue); font-size: 1.5rem;"></i>
                        <div>
                            <div style="font-weight: 600;">${achievement.name}</div>
                            <div style="font-size: 12px; color: var(--silver-mirror);">Achievement Unlocked</div>
                        </div>
                    `;
                    achievementsList.appendChild(achievementEl);
                }
            });
        }

        function initReviewPage() {
            const moduleFilter = document.getElementById('module-filter');
            moduleFilter.innerHTML = '<option value="all">All Modules</option>';
            quizData.modules.forEach(module => {
                const option = document.createElement('option');
                option.value = module.id;
                option.textContent = module.name;
                moduleFilter.appendChild(option);
            });
            
            moduleFilter.addEventListener('change', () => {
                filterReviewQuestions('module');
            });
            
            filterReviewQuestions('all');
        }

        function filterReviewQuestions(filter) {
            const reviewList = document.getElementById('review-list');
            reviewList.innerHTML = '';
            
            let questionsToShow = [];
            
            appState.userData.quizHistory.forEach(quiz => {
                quiz.questions = quiz.type === 'full' ? 
                    getAllQuestions() : 
                    quizData.modules.find(m => m.id === quiz.moduleId)?.questions || [];
                
                quiz.questions.forEach((question, index) => {
                    const userAnswer = quiz.answers[index];
                    const isCorrect = userAnswer === question.correctAnswer;
                    
                    let include = false;
                    switch(filter) {
                        case 'all': include = true; break;
                        case 'incorrect': include = !isCorrect; break;
                        case 'module':
                            const moduleId = parseInt(document.getElementById('module-filter').value);
                            include = isNaN(moduleId) || question.moduleId === moduleId;
                            break;
                    }
                    
                    if (include) {
                        questionsToShow.push({
                            question,
                            userAnswer,
                            isCorrect,
                            quizDate: quiz.date
                        });
                    }
                });
            });
            
            if (questionsToShow.length === 0) {
                reviewList.innerHTML = `
                    <div style="text-align: center; padding: 36px; color: var(--silver-mirror);">
                        <i class="fas fa-clipboard-check" style="font-size: 36px; margin-bottom: 20px;"></i>
                        <h3>No questions to review</h3>
                        <p>Complete some quizzes to see questions here.</p>
                    </div>
                `;
                return;
            }
            
            questionsToShow.forEach((item, index) => {
                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${item.isCorrect ? 'correct' : ''}`;
                
                const module = quizData.modules.find(m => m.id === item.question.moduleId);
                
                reviewItem.innerHTML = `
                    <div class="question-header">
                        <div class="question-topic">${module ? module.name : 'General'}</div>
                        <div style="color: ${item.isCorrect ? 'var(--lime-green)' : 'var(--neon-red)'};">
                            ${item.isCorrect ? 'Correct' : 'Incorrect'}
                        </div>
                    </div>
                    <div class="question-text">${index + 1}. ${item.question.question}</div>
                    <div class="answer-comparison">
                        <div class="answer-box user-answer-box">
                            <div class="answer-label user-answer-label">
                                <i class="fas fa-user"></i> Your Answer
                            </div>
                            <div>${item.userAnswer !== null ? 
                                `${String.fromCharCode(65 + item.userAnswer)}. ${item.question.options[item.userAnswer]}` : 
                                'Not answered'}</div>
                        </div>
                        ${!item.isCorrect ? `
                        <div class="answer-box correct-answer-box">
                            <div class="answer-label correct-answer-label">
                                <i class="fas fa-check-circle"></i> Correct Answer
                            </div>
                            <div>${String.fromCharCode(65 + item.question.correctAnswer)}. ${item.question.options[item.question.correctAnswer]}</div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="explanation-box">
                        <div class="explanation-title">
                            <i class="fas fa-info-circle"></i> Explanation
                        </div>
                        <div>${item.question.explanation}</div>
                    </div>
                `;
                
                reviewList.appendChild(reviewItem);
            });
        }

        function getAllQuestions() {
            const allQuestions = [];
            quizData.modules.forEach(module => {
                module.questions.forEach(q => {
                    allQuestions.push({
                        ...q,
                        moduleId: module.id
                    });
                });
            });
            return allQuestions;
        }

        function initFeedbackPage() {
            document.getElementById('feedback-form').reset();
            setRating(0);
        }

        function setRating(value) {
            document.querySelectorAll('.rating-star').forEach((star, index) => {
                if (index < value) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            document.getElementById('rating-value').value = value;
        }

        function submitFeedback(e) {
            e.preventDefault();
            const feedback = {
                id: Date.now(),
                name: document.getElementById('feedback-name').value,
                email: document.getElementById('feedback-email').value,
                type: document.getElementById('feedback-type').value,
                rating: parseInt(document.getElementById('rating-value').value),
                message: document.getElementById('feedback-message').value,
                date: new Date().toISOString()
            };
            appState.userData.feedback.push(feedback);
            saveUserData();
            alert('Thank you for your feedback! Your input helps us improve the platform.');
            document.getElementById('feedback-form').reset();
            setRating(0);
        }

        function initSettingsPage() {
            document.getElementById('dark-mode-toggle').checked = appState.userData.settings.darkMode;
            document.getElementById('sound-effects-toggle').checked = appState.userData.settings.soundEnabled;
            document.getElementById('explanations-toggle').checked = appState.userData.settings.showExplanations;
            document.getElementById('timer-toggle').checked = appState.userData.settings.showTimer;
            document.getElementById('volume-level').value = appState.userData.settings.volumeLevel;
            document.getElementById('volume-level-value').textContent = getVolumeLabel(appState.userData.settings.volumeLevel);
        }

        function applySettings() {
            if (appState.userData.settings.darkMode) {
                document.body.classList.remove('light-mode');
            } else {
                document.body.classList.add('light-mode');
            }
            Object.values(appState.audioElements).forEach(audio => {
                audio.volume = appState.userData.settings.volumeLevel / 10;
            });
        }

        function toggleDarkMode() {
            appState.userData.settings.darkMode = document.getElementById('dark-mode-toggle').checked;
            applySettings();
            saveUserData();
        }

        function toggleSoundEffects() {
            appState.userData.settings.soundEnabled = document.getElementById('sound-effects-toggle').checked;
            saveUserData();
        }

        function toggleExplanations() {
            appState.userData.settings.showExplanations = document.getElementById('explanations-toggle').checked;
            saveUserData();
        }

        function toggleTimer() {
            appState.userData.settings.showTimer = document.getElementById('timer-toggle').checked;
            saveUserData();
        }

        function updateVolume() {
            const value = parseInt(document.getElementById('volume-level').value);
            appState.userData.settings.volumeLevel = value;
            document.getElementById('volume-level-value').textContent = getVolumeLabel(value);
            applySettings();
            saveUserData();
        }

        function getVolumeLabel(value) {
            if (value <= 3) return 'Low';
            if (value <= 7) return 'Medium';
            return 'High';
        }

        function updateNeonIntensity() {
            const value = parseInt(document.getElementById('neon-intensity').value);
            const labels = ['Subtle', 'Medium', 'Bright'];
            document.getElementById('neon-intensity-value').textContent = labels[value - 1];
            document.body.setAttribute('data-neon-intensity', value);
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
                localStorage.removeItem('microEconomicsQuizData');
                location.reload();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(appState.userData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = 'micro-economics-quiz-data.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function playSound(type) {
            if (appState.userData.settings.soundEnabled && appState.audioElements[type]) {
                appState.audioElements[type].currentTime = 0;
                appState.audioElements[type].play().catch(e => console.log('Audio play failed:', e));
            }
        }

        function downloadPDF() {
            alert('PDF report generation feature would go here.');
        }

        function downloadCSV() {
            let csvContent = "Module,Question,Your Answer,Correct Answer,Result,Date\n";
            appState.userData.quizHistory.forEach(quiz => {
                quiz.questions.forEach((question, index) => {
                    const module = quizData.modules.find(m => m.id === question.moduleId);
                    const userAnswer = quiz.answers[index];
                    const isCorrect = userAnswer === question.correctAnswer;
                    csvContent += `"${module ? module.name : 'General'}","${question.question}","${userAnswer !== null ? question.options[userAnswer] : 'Not answered'}","${question.options[question.correctAnswer]}","${isCorrect ? 'Correct' : 'Incorrect'}","${quiz.date}"\n`;
                });
            });
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'quiz-results.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadCertificate() {
            alert('Certificate generation feature would go here.');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
